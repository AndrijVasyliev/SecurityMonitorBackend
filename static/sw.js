"use strict";const DYNAMIC_HASH_CACHE_NAME="log4u-sw-dynamic-hash-cache",DYNAMIC_HEADERS_CACHE_NAME="log4u-sw-dynamic-headers-cache",DEFAULT_CACHE_LIFETIME=2592e5,checkJs=e=>{const t=e.length;return t>=3&&"js"===e[t-1]?"bundle"===e[t-2]||"chunk"===e[t-2]||"worker"===e[t-2]?(e.splice(t-3,1),e):(e.splice(t-2,1),e):null},checkJson=e=>{const t=e.length;return t>=3&&"json"===e[t-1]?(e.splice(t-2,1),e):null},checkCss=e=>{const t=e.length;return t>=3&&"css"===e[t-1]?"chunk"===e[t-2]?(e.splice(t-3,1),e):(e.splice(t-2,1),e):null},getDateOrError=e=>{try{const t=new Date(e);return isNaN(t)?new Error:t}catch(t){return t}},getMaxAgeOrError=e=>{const t=e.toLowerCase().split(",").find((e=>e?.trim().startsWith("max-age")))?.trim();if(!t)return;const r=t.split("=")[1];return!r||isNaN(+r)?new Error:+r};function onInstall(e){self.skipWaiting()}function onActivate(e){e.waitUntil(Promise.all([(async()=>{const e=await caches.keys();return await Promise.all(e.filter((e=>e!==DYNAMIC_HASH_CACHE_NAME&&e!==DYNAMIC_HEADERS_CACHE_NAME)).map((e=>caches.delete(e))))})(),clients.claim()]))}function onFetch(e){if("navigate"===e.request.mode||"websocket"===e.request.mode)return;new URL(e.request.url).origin===location.origin&&e.respondWith(router(e.request))}async function router(e){const t=new URL(e.url);if("GET"===e.method&&!t.pathname.startsWith("/api"))try{const r={method:e.method,mode:e.mode,headers:new Headers(e.headers),credentials:"same-origin"},n=t.pathname.split("."),a=(checkJs(n)||checkCss(n)||checkJson(n))?.join(".");if(a){const t=await caches.open(DYNAMIC_HASH_CACHE_NAME),n=await t.match(a);if(n&&n.url===e.url)return console.debug("[SW] Return cached asset: ",e.url),n;const s=await fetch(e.url,r);return s.ok&&(await t.put(a,s.clone()),console.debug("[SW] Added asset: ",e.url)),console.debug("[SW] Returning asset: ",e.url),s}const s=await caches.open(DYNAMIC_HEADERS_CACHE_NAME),o=await s.match(e);if(o){const t=o.headers.get("ETag");if(t)t&&(console.debug("[SW] If-None-Match: ",t),r.headers.append("If-None-Match",t));else{const t=o?.headers.get("Expires"),r=o?.headers.get("Date"),n=o?.headers.get("Cache-Control"),a=t?getDateOrError(t):void 0,c=r?getDateOrError(r):void 0,l=n?getMaxAgeOrError(n):void 0;if(a instanceof Error)await s.delete(e),console.debug("[SW] Deleted expiresDate error: ",e.url);else if(c instanceof Error)await s.delete(e),console.debug("[SW] Deleted dateDate error: ",e.url);else if(l instanceof Error)await s.delete(e),console.debug("[SW] Deleted cacheControlMaxAge error: ",e.url);else if(c+1e3*l<new Date)await s.delete(e),console.debug("[SW] Deleted maxAge: ",e.url);else if(c<new Date+DEFAULT_CACHE_LIFETIME)await s.delete(e),console.debug("[SW] Deleted lifetime: ",e.url);else{if(!(a<new Date))return console.debug("[SW] Return cached: ",e.url),o;await s.delete(e),console.debug("[SW] Deleted expire: ",e.url)}}}const c=await fetch(e.url,r);return 304===c.status&&o?(console.debug("[SW] Return after 304: ",e.url),o):(c.ok&&(c?.headers.get("ETag")||c?.headers.get("Expires")||c?.headers.get("Date"))&&!c?.headers.get("Cache-Control")?.toLowerCase().split(",").includes("no-store")?(await s.put(e,c.clone()),console.debug("[SW] Added: ",e.url)):o&&(await s.delete(e),console.debug("[SW] Deleted bed: ",e.url)),console.debug("[SW] Returning: ",e.url),c)}catch(r){return console.error(r),fetch(e)}return fetch(e)}self.addEventListener("install",onInstall),self.addEventListener("activate",onActivate),self.addEventListener("fetch",onFetch);